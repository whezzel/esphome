substitutions:
  api_key: !secret desk-switch-panel_api_key
  board: wemos_d1_mini32
  device: Switch Panel
  devicename: desk-switch-panel
  log_level: DEBUG
  room: Desk

  switch1_pin: 32
  switch1_id: switch1
  switch1_num: "1"
  switch1_single_service: "switch.toggle"
  switch1_single_entity: "switch.bath_1_switch_1_relay"
  switch1_double_service: ""
  switch1_double_entity: ""

  switch2_pin: 16
  switch2_id: switch2
  switch2_num: "2"
  switch2_single_service: "switch.toggle"
  switch2_single_entity: "switch.bedroom_1_shelly_light"
  switch2_double_service: "switch.toggle"
  switch2_double_entity: "switch.bedroom_1_lamp_relay"

  switch3_pin: 5
  switch3_id: switch3
  switch3_num: "3"
  switch3_single_service: "switch.toggle"
  switch3_single_entity: "switch.bath_2_switch_1_relay"
  switch3_double_service: ""
  switch3_double_entity: ""

  switch4_pin: 23
  switch4_id: switch4
  switch4_num: "4"
  switch4_single_service: "switch.toggle"
  switch4_single_entity: "switch.bedroom_2_shelly_light"
  switch4_double_service: ""
  switch4_double_entity: ""

  switch5_pin: 21
  switch5_id: switch5
  switch5_num: "5"
  switch5_single_service: "switch.toggle"
  switch5_single_entity: "switch.hobby_room_shelly_light"
  switch5_double_service: ""
  switch5_double_entity: ""

  switch6_pin: 17
  switch6_id: switch6
  switch6_num: "6"
  switch6_single_service: "light.toggle"
  switch6_single_entity: "light.kitchen_lights"
  switch6_double_service: "switch.toggle"
  switch6_double_entity: "switch.kitchen_lamp_relay"

  switch7_pin: 25
  switch7_id: switch7
  switch7_num: "7"
  switch7_single_service: "switch.toggle"
  switch7_single_entity: "switch.living_room_shelly_light"
  switch7_double_service: ""
  switch7_double_entity: ""

  switch8_pin: 19
  switch8_id: switch8
  switch8_num: "8"
  switch8_single_service: "switch.toggle"
  switch8_single_entity: "switch.utility_room_switch_1_relay"
  switch8_double_service: ""
  switch8_double_entity: ""

  switch9_pin: 26
  switch9_id: switch9
  switch9_num: "9"
  switch9_single_service: "switch.toggle"
  switch9_single_entity: "switch.front_porch_switch_relay"
  switch9_double_service: ""
  switch9_double_entity: ""

  switch10_pin: 18
  switch10_id: switch10
  switch10_num: "10"
  switch10_single_service: ""
  switch10_single_entity: ""
  switch10_double_service: ""
  switch10_double_entity: ""

  switch11_pin: 22
  switch11_id: switch11
  switch11_num: "11"
  switch11_single_service: "light.toggle"
  switch11_single_entity: "light.desk_light"
  switch11_double_service: ""
  switch11_double_entity: ""

  switch12_pin: 33
  switch12_id: switch12
  switch12_num: "12"
  switch12_single_service: "light.toggle"
  switch12_single_entity: "light.all_lights"
  switch12_double_service: ""
  switch12_double_entity: ""
  
packages:
  api: !include /config/common/api.yaml
  binary_sensor: !include /config/common/binary_sensor.yaml
  esp32_ble_tracker: !include /config/common/esp32_ble_tracker.yaml
  esp32: !include /config/common/esp32.yaml
  esphome: !include /config/common/esphome.yaml
  logger: !include /config/common/logger.yaml
  ota: !include /config/common/ota.yaml
  sensor: !include /config/common/sensor.yaml
  switch: !include /config/common/switch.yaml
  text_sensor: !include /config/common/text_sensor.yaml
  time: !include /config/common/time.yaml
  web_server: !include /config/common/web_server.yaml
  wifi: !include /config/common/wifi.yaml

api:
  on_client_connected:
     - esp32_ble_tracker.start_scan:
        continuous: true
  on_client_disconnected:
    if:
      condition:
        not:
          api.connected:
      then:
        - esp32_ble_tracker.stop_scan:

status_led:
    pin:
      number: 2
      inverted: false
      ignore_strapping_warning: true

binary_sensor:
  - platform: gpio
    pin:
      number: ${switch1_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch1_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch1_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch1_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch1_single_service}
                          data:
                            entity_id: ${switch1_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch1_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch1_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch1_double_service}
                          data:
                            entity_id: ${switch1_double_entity}
  - platform: gpio
    pin:
      number: ${switch2_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch2_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch2_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch2_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch2_single_service}
                          data:
                            entity_id: ${switch2_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch2_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch2_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch2_double_service}
                          data:
                            entity_id: ${switch2_double_entity}
  - platform: gpio
    pin:
      number: ${switch3_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch3_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch3_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch3_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch3_single_service}
                          data:
                            entity_id: ${switch3_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch3_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch3_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch3_double_service}
                          data:
                            entity_id: ${switch3_double_entity}
  - platform: gpio
    pin:
      number: ${switch4_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch4_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch4_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch4_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch4_single_service}
                          data:
                            entity_id: ${switch4_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch4_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch4_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch4_double_service}
                          data:
                            entity_id: ${switch4_double_entity}
  - platform: gpio
    pin:
      number: ${switch5_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch5_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch5_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch5_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch5_single_service}
                          data:
                            entity_id: ${switch5_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch5_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch5_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch5_double_service}
                          data:
                            entity_id: ${switch5_double_entity}
  - platform: gpio
    pin:
      number: ${switch6_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch6_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch6_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch6_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch6_single_service}
                          data:
                            entity_id: ${switch6_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch6_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch6_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch6_double_service}
                          data:
                            entity_id: ${switch6_double_entity}
  - platform: gpio
    pin:
      number: ${switch7_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch7_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch7_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch7_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch7_single_service}
                          data:
                            entity_id: ${switch7_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch7_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch7_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch7_double_service}
                          data:
                            entity_id: ${switch7_double_entity}
  - platform: gpio
    pin:
      number: ${switch8_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch8_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch8_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch8_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch8_single_service}
                          data:
                            entity_id: ${switch8_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch8_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch8_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch8_double_service}
                          data:
                            entity_id: ${switch8_double_entity}
  - platform: gpio
    pin:
      number: ${switch9_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch9_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch9_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch9_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch9_single_service}
                          data:
                            entity_id: ${switch9_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch9_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch9_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch9_double_service}
                          data:
                            entity_id: ${switch9_double_entity}
  - platform: gpio
    pin:
      number: ${switch10_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch10_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch10_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch10_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch10_single_service}
                          data:
                            entity_id: ${switch10_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch10_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch10_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch10_double_service}
                          data:
                            entity_id: ${switch10_double_entity}
  - platform: gpio
    pin:
      number: ${switch11_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch11_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch11_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch11_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch11_single_service}
                          data:
                            entity_id: ${switch11_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch11_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch11_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch11_double_service}
                          data:
                            entity_id: ${switch11_double_entity}
  - platform: gpio
    pin:
      number: ${switch12_pin}
      mode: INPUT_PULLUP
      inverted: true
    id: ${switch12_id}
    filters:
      - delayed_on_off: 50ms
    on_multi_click:
      - timing:
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch12_num} Single-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch12_single_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch12_single_service}
                          data:
                            entity_id: ${switch12_single_entity}
      - timing:
          - ON for at most 400ms
          - OFF for at most 200ms
          - ON for at most 400ms
          - OFF for at least 200ms
        then:
          - logger.log: "SW${switch12_num} Double-Click Detected"
          - if:
              condition:
                api.connected:
              then:
                - if:
                    condition:
                      lambda: 'return "${switch12_double_service}" != "";'
                    then:
                      - homeassistant.service:
                          service: ${switch12_double_service}
                          data:
                            entity_id: ${switch12_double_entity}
